/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
define("vs/base/worker/workerServer",["require","exports"],function(e,t){"use strict";function s(e){var t={};return e.stacktrace?t.stack=e.stacktrace.split("\n"):e.stack&&(t.stack=e.stack.split("\n")),t.message=e.toString(),t}var r=e,i=function(){function t(e){this.postMessage=e,this.workerId=0,this.requestHandler=null,this._waitingSchedules={},this.lastScheduleId=0,this._bindConsole()}return t.prototype.schedule=function(e,t){"undefined"==typeof t&&(t=0);var s=++this.lastScheduleId;return this._waitingSchedules[s]=e,this.postMessage({monacoWorker:!0,from:this.workerId,type:"$schedule",scheduleId:s,timestamp:(new Date).getTime()+t}),s},t.prototype.clearSchedule=function(e){this._waitingSchedules.hasOwnProperty(String(e))&&delete this._waitingSchedules[e]},t.prototype._bindConsole=function(){self.console={log:this._sendPrintMessage.bind(this,"log"),debug:this._sendPrintMessage.bind(this,"debug"),info:this._sendPrintMessage.bind(this,"info"),warn:this._sendPrintMessage.bind(this,"warn"),error:this._sendPrintMessage.bind(this,"error")}},t.prototype._sendPrintMessage=function(e,t){this.postMessage({monacoWorker:!0,from:this.workerId,type:"$print",level:e,payload:t instanceof Error?s(t):t})},t.prototype._sendReply=function(e,t,r){this.postMessage({monacoWorker:!0,from:this.workerId,id:e,type:"$reply",action:t,payload:r instanceof Error?s(r):r})},t.prototype.request=function(e,t){if("$"===e.charAt(0))throw new Error("Illegal requestName: "+e);this.postMessage({monacoWorker:!0,from:this.workerId,type:e,payload:t})},t.prototype.loadModule=function(t,s,i){r.onError=i,e([t],function(e){s(e),r.onError=null}.bind(this))},t.prototype.onmessage=function(e){var t=this,r=this._sendReply.bind(this,e.id,"complete"),i=this._sendReply.bind(this,e.id,"error"),n=this._sendReply.bind(this,e.id,"progress");switch(e.type){case"$initialize":this.workerId=e.payload.id,this.loadModule(e.payload.moduleId,function(e){t.requestHandler=e.value,r()},i);break;case"$schedule":if(this._waitingSchedules.hasOwnProperty(e.payload.scheduleId)){var o=this._waitingSchedules[e.payload.scheduleId];delete this._waitingSchedules[e.payload.scheduleId];try{o(),r()}catch(a){i(s(a))}}else r();break;default:this.handleMessage(e,r,i,n)}},t.prototype.handleMessage=function(e,t,r,i){if(!this.requestHandler)return r("Request handler not loaded"),void 0;if(e.type in this.requestHandler&&"function"==typeof this.requestHandler[e.type])try{this.requestHandler[e.type].call(this.requestHandler,this,t,r,i,e.payload)}catch(n){r(s(n))}else this.requestHandler.request(this,t,r,i,e)},t}();t.WorkerServer=i});